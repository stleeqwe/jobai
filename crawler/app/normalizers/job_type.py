"""직무명 정규화 모듈"""

from typing import Optional

# 직무명 정규화 매핑 (원본 키워드 -> 정규화된 직무명)
JOB_TYPE_MAPPING: dict[str, list[str]] = {
    # IT/개발
    "백엔드": ["백엔드", "서버개발", "서버 개발", "backend", "server", "java개발", "python개발"],
    "프론트엔드": ["프론트엔드", "프론트", "frontend", "front-end", "웹퍼블리셔", "퍼블리셔"],
    "풀스택": ["풀스택", "full-stack", "fullstack", "풀스택개발"],
    "앱개발": ["앱개발", "ios", "android", "안드로이드", "모바일개발", "앱 개발", "flutter", "react native"],
    "데이터엔지니어": ["데이터엔지니어", "data engineer", "데이터 엔지니어", "빅데이터"],
    "데이터분석가": ["데이터분석", "data analyst", "데이터 분석", "bi"],
    "AI엔지니어": ["ai엔지니어", "머신러닝", "machine learning", "딥러닝", "ml엔지니어", "ai 개발"],
    "DevOps": ["devops", "데브옵스", "sre", "인프라", "클라우드엔지니어"],
    "QA": ["qa", "테스터", "품질관리", "테스트엔지니어"],
    "DBA": ["dba", "데이터베이스", "db관리"],
    "보안": ["보안", "security", "정보보안", "사이버보안"],
    "소프트웨어개발": ["소프트웨어 개발", "software", "sw개발", "개발자"],
    "임베디드": ["임베디드", "embedded", "펌웨어", "firmware"],
    "게임개발": ["게임개발", "게임 개발", "유니티", "언리얼"],

    # 디자인
    "웹디자이너": ["웹디자이너", "ui디자이너", "ux디자이너", "ui/ux", "웹디자인", "uiux"],
    "그래픽디자이너": ["그래픽디자이너", "시각디자인", "편집디자인", "그래픽 디자인"],
    "영상디자이너": ["영상디자이너", "모션그래픽", "영상편집", "영상 디자인"],
    "3D디자이너": ["3d디자이너", "3d모델러", "3d 디자인"],
    "제품디자이너": ["제품디자이너", "product designer", "프로덕트디자이너"],
    "브랜드디자이너": ["브랜드디자이너", "bi디자이너", "브랜드 디자인"],
    "인테리어디자이너": ["인테리어 디자이너", "인테리어디자이너", "공간디자인"],
    "패션디자이너": ["패션디자이너", "의상디자인"],

    # 기획/PM
    "서비스기획": ["서비스기획", "기획자", "pm", "product manager", "프로덕트매니저", "상품기획"],
    "프로젝트매니저": ["프로젝트매니저", "pmo", "프로젝트 관리"],
    "사업기획": ["사업기획", "사업개발", "bd", "business development"],
    "전략기획": ["전략기획", "경영기획", "전략 기획"],

    # 마케팅
    "마케터": ["마케터", "마케팅", "마케팅담당"],
    "퍼포먼스마케터": ["퍼포먼스마케터", "퍼포먼스 마케팅", "그로스마케터", "그로스해커"],
    "콘텐츠마케터": ["콘텐츠마케터", "콘텐츠 마케팅", "콘텐츠기획"],
    "브랜드마케터": ["브랜드마케터", "브랜드 마케팅", "브랜드매니저"],
    "CRM마케터": ["crm", "crm마케터", "고객관리"],

    # 영업
    "영업": ["영업", "세일즈", "sales", "영업담당", "영업직", "아웃바운드"],
    "기술영업": ["기술영업", "se", "솔루션영업"],
    "해외영업": ["해외영업", "글로벌영업", "무역"],
    "매장관리": ["매장관리", "매장 매니저", "점장", "스토어매니저"],

    # 경영지원
    "인사": ["인사", "hr", "채용", "인사담당"],
    "총무": ["총무", "경영지원", "관리", "사무"],
    "재무회계": ["재무", "회계", "경리", "재무회계", "기장", "세무"],
    "법무": ["법무", "법률", "계약", "법률사무"],
    "비서": ["비서", "행정", "사무보조"],

    # 고객서비스
    "고객상담": ["고객상담", "cs", "고객서비스", "상담원", "콜센터", "상담사"],
    "CS매니저": ["cs매니저", "고객경험", "cx"],

    # 서비스/외식
    "바리스타": ["바리스타", "카페"],
    "조리사": ["조리사", "요리사", "셰프", "주방", "브런치", "베이커"],
    "서비스매니저": ["서비스매니저", "홀매니저", "레스토랑"],

    # 의료/헬스케어
    "간호사": ["간호사", "간호"],
    "의료기사": ["의료기사", "방사선사", "임상병리"],
    "물리치료사": ["물리치료", "재활"],

    # 교육
    "강사": ["강사", "교사", "선생님", "튜터", "멘토"],
    "교육기획": ["교육기획", "교육컨텐츠"],

    # 연구개발
    "연구원": ["연구원", "연구", "r&d"],

    # 크리에이티브
    "콘텐츠크리에이터": ["크리에이터", "bj", "유튜버", "인플루언서"],
    "PD": ["pd", "디렉터", "td"],
}

# 직무 카테고리 매핑
JOB_CATEGORY_MAPPING: dict[str, str] = {
    # IT개발
    "백엔드": "IT개발",
    "프론트엔드": "IT개발",
    "풀스택": "IT개발",
    "앱개발": "IT개발",
    "데이터엔지니어": "IT개발",
    "데이터분석가": "IT개발",
    "AI엔지니어": "IT개발",
    "DevOps": "IT개발",
    "QA": "IT개발",
    "DBA": "IT개발",
    "보안": "IT개발",
    "소프트웨어개발": "IT개발",
    "임베디드": "IT개발",
    "게임개발": "IT개발",
    # 디자인
    "웹디자이너": "디자인",
    "그래픽디자이너": "디자인",
    "영상디자이너": "디자인",
    "3D디자이너": "디자인",
    "제품디자이너": "디자인",
    "브랜드디자이너": "디자인",
    "인테리어디자이너": "디자인",
    "패션디자이너": "디자인",
    # 기획
    "서비스기획": "기획",
    "프로젝트매니저": "기획",
    "사업기획": "기획",
    "전략기획": "기획",
    # 마케팅
    "마케터": "마케팅",
    "퍼포먼스마케터": "마케팅",
    "콘텐츠마케터": "마케팅",
    "브랜드마케터": "마케팅",
    "CRM마케터": "마케팅",
    # 영업
    "영업": "영업",
    "기술영업": "영업",
    "해외영업": "영업",
    "매장관리": "영업",
    # 경영지원
    "인사": "경영지원",
    "총무": "경영지원",
    "재무회계": "경영지원",
    "법무": "경영지원",
    "비서": "경영지원",
    # 서비스
    "고객상담": "서비스",
    "CS매니저": "서비스",
    "바리스타": "서비스",
    "조리사": "서비스",
    "서비스매니저": "서비스",
    # 의료
    "간호사": "의료",
    "의료기사": "의료",
    "물리치료사": "의료",
    # 교육
    "강사": "교육",
    "교육기획": "교육",
    # 연구
    "연구원": "연구개발",
    # 크리에이티브
    "콘텐츠크리에이터": "크리에이티브",
    "PD": "크리에이티브",
}


def normalize_job_type(raw_text: str) -> str:
    """
    원본 직무명을 정규화된 직무명으로 변환

    Args:
        raw_text: 원본 직무명 텍스트

    Returns:
        정규화된 직무명 (매핑 실패 시 원본 반환)
    """
    if not raw_text:
        return ""

    raw_lower = raw_text.lower().strip()

    for normalized, variants in JOB_TYPE_MAPPING.items():
        for variant in variants:
            if variant.lower() in raw_lower:
                return normalized

    return raw_text.strip()


def get_job_category(job_type: str) -> str:
    """
    정규화된 직무명에서 카테고리 추출

    Args:
        job_type: 정규화된 직무명

    Returns:
        직무 카테고리 (매핑 실패 시 '기타')
    """
    return JOB_CATEGORY_MAPPING.get(job_type, "기타")


def extract_job_keywords(raw_text: str) -> list[str]:
    """
    직무 텍스트에서 키워드 추출

    Args:
        raw_text: 원본 직무/스킬 텍스트

    Returns:
        추출된 키워드 리스트
    """
    if not raw_text:
        return []

    # 주요 기술 스택 키워드
    tech_keywords = [
        "python", "java", "javascript", "typescript", "react", "vue", "angular",
        "node.js", "spring", "django", "fastapi", "flask",
        "aws", "gcp", "azure", "docker", "kubernetes", "k8s",
        "mysql", "postgresql", "mongodb", "redis",
        "git", "jenkins", "ci/cd",
        "figma", "photoshop", "illustrator", "sketch", "xd",
        "sql", "nosql", "graphql", "rest api",
    ]

    raw_lower = raw_text.lower()
    found_keywords = []

    for keyword in tech_keywords:
        if keyword in raw_lower:
            found_keywords.append(keyword)

    return found_keywords
