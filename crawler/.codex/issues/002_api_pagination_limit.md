# API 페이지네이션 250페이지 제한

**ID**: 002
**생성일**: 2026-01-16
**상태**: `resolved`
**해결일**: 2026-01-16
**관련 이슈**: 없음

---

## 1. 증상

- 500페이지 크롤링 요청했으나 실제 10,000개 ID만 수집됨
- 250페이지 이후 동일한 결과 반복 반환
- 서울 전체 64,000건 중 10,000건만 수집 가능

```bash
# 페이지별 ID 중복 확인
페이지 1-250: 고유 ID 반환
페이지 251+: 페이지 250과 동일한 결과
```

---

## 2. 원인 분석

**관련 파일**:
- `app/core/ajax_client.py` - `fetch_page()` 메서드

**원인**:
- 잡코리아 AJAX API `/Recruit/Home/_GI_List`의 서버측 제한
- 시간대별 가변적 제한 확인:
  - 낮 시간: 500페이지까지 작동
  - 야간/새벽: 250페이지 제한

**검증 방법**:
```python
# 페이지 250과 251의 결과 비교
page_250_ids = await ajax.fetch_page(250)
page_251_ids = await ajax.fetch_page(251)
print(page_250_ids == page_251_ids)  # True → 제한 확인
```

---

## 3. 이전 유사 이슈 확인

- [x] `.codex/issues/` 검색 완료
- 검색 키워드: pagination, 페이지, 제한
- 유사 이슈: 없음

---

## 4. 해결 방안

### 선택지 A: 구별 필터 병렬 크롤링
- 장점: API 제한 우회, 전체 데이터 수집 가능
- 단점: 구간 중복 발생 (15% 정도), 시간 소요 증가

### 선택지 B: API 제한 내에서 운영 (10,000건)
- 장점: 단순, 빠름
- 단점: 전체 데이터의 15% 수준만 수집

### 선택지 C: 시간대별 크롤링 (낮 시간 활용)
- 장점: 추가 구현 불필요
- 단점: 불안정, 시간대 의존

**선택**: A + B 병행
**이유**: 
- 일상 운영: B (10,000건 Daily Sync)
- 주간 전체 수집: A (구별 크롤링)

---

## 5. 수정 내용

### 구별 크롤링 스크립트
```python
# run_crawl_by_gu.py

SEOUL_GU_CODES = {
    "강남구": "I010",
    "강동구": "I020",
    # ... 25개 구
}

async def crawl_by_gu():
    all_ids = set()
    for gu_name, gu_code in SEOUL_GU_CODES.items():
        ids = await ajax.fetch_all_pages(local=gu_code)
        all_ids.update(ids)
    return all_ids
```

### 변경 파일 체크리스트
- [x] `run_crawl_by_gu.py` 생성
- [x] `docs/CRAWLER.md` 문서화

---

## 6. 검증

### 검증 명령어
```bash
python run_crawl_by_gu.py --test  # 3개 구 테스트
```

### 결과
| 항목 | 값 |
|------|------|
| 테스트 구 | 성동구 + 송파구 + 구로구 |
| 예상 합계 | 2,634건 |
| 실제 수집 | 2,229건 (고유 ID) |
| 구간 중복율 | 15.4% |

### 전체 수집 예상
| 항목 | 값 |
|------|------|
| 구 수 | 25개 |
| 총합 | ~83,000건 |
| 중복 제거 후 | ~60,000-65,000건 |
| 예상 소요 | 4-5시간 |

---

## 7. 회고

### 이 문제를 예방하려면?
- 외부 API 사용 시 제한 사항 먼저 테스트
- 페이지네이션 결과 중복 체크 로직 추가

### 다음에 참고할 점
- 잡코리아 API는 시간대별로 제한이 다름
- 전체 수집 필요 시 구별 분할 크롤링 사용
- 강남구(16,000건)는 추가 분할 필요 (직무 카테고리별)

### 관련 체크리스트 추가 필요?
- [x] 예 → CRAWLER.md 섹션 7.4 추가됨
